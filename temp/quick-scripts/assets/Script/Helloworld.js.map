{"version":3,"sources":["Helloworld.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["const {ccclass, property} = cc._decorator;\n\nimport DefaultBall from './DefaultBall'\n\nconst level: number[] = [2, 4, 8, 16, 32, 64, 128, 256, 512, 1024];\n\n@ccclass\nexport default class Helloworld extends cc.Component {\n\n    @property(cc.Node)\n    gameBox: cc.Node = null;\n\n    @property(cc.Prefab)\n    defaultBall: cc.Prefab = null;\n\n    // 鱼塘 --- Start ---\n    @property({type: cc.Node, displayName: \"鱼塘Node\"})\n    water: cc.Node = null;\n\n    @property({type: cc.Prefab, displayName: \"鱼的Prefab\"})\n    fishPrefab: cc.Prefab = null;\n\n    @property({type: cc.SpriteAtlas, displayName: \"鱼的资源图片\"})\n    fishAtlas: cc.SpriteAtlas = null;\n    // 鱼塘 --- End ---\n\n    @property({type: [cc.AudioClip], displayName: \"BGM\"})\n    bgmList: [cc.AudioClip] = [null];\n\n    _touchDownState: boolean = false;\n    _touchDownEvent: any = null;\n\n    _gameBoxLife_Y: number = 0;\n\n    _nextBall: cc.Node = null;\n    _lastTouchPosition: cc.Vec2 = null;\n\n    _ballIndex: number = 0;\n    \n    onLoad () {\n        cc.director.getPhysicsManager().enabled = true;\n        // cc.director.getPhysicsManager().debugDrawFlags = cc.PhysicsManager.DrawBits.e_aabbBit |\n        //     cc.PhysicsManager.DrawBits.e_jointBit |\n        //     cc.PhysicsManager.DrawBits.e_shapeBit;\n        cc.director.getPhysicsManager().gravity = cc.v2(0, -640);\n\n        // 球顶部位置\n        const _gameBoxWidth = this.gameBox.width;\n        const _gameBoxHeight = this.gameBox.height;\n        this._gameBoxLife_Y = this.gameBox.convertToNodeSpaceAR(cc.v2(0)).y + _gameBoxHeight * (4/5);\n\n        // this._lastTouchPosition = cc.v2(this.gameBox.convertToNodeSpaceAR(cc.v2(0)).x + cc.view.getCanvasSize().width / 2, this._gameBoxLife_Y);\n\n        // 生成第一个球/读档上一次退出时的球\n        this.makeDefaultBall();\n    }\n\n    start () {\n        this.gameBox.on(cc.Node.EventType.TOUCH_MOVE, function(event){\n            if (this._nextBall == null) {\n                return;\n            }\n            this.onMoveBall((event.touch as cc.Touch).getDelta());\n        }.bind(this));\n\n        // 单次点击\n        this.gameBox.on(cc.Node.EventType.TOUCH_END, function(event){\n            if (this._nextBall == null) {\n                return;\n            }\n            this.onClick(event)\n        }.bind(this));\n\n        this.generateFishes();\n    }\n\n    update() {\n    }\n\n    makeDefaultBall() {\n        const _nextBallNum = level[Math.ceil(Math.random()*level.length-1)];\n        this._ballIndex += 1;\n\n        var ball = cc.instantiate(this.defaultBall);\n        (ball.getComponent(DefaultBall) as DefaultBall).text = _nextBallNum + '';\n        (ball.getComponent(DefaultBall) as DefaultBall).index = this._ballIndex;\n        ball.opacity = 0;\n        ball.scale = 0.5;\n        this.gameBox.addChild(ball);\n\n        var point = this._lastTouchPosition;\n        if(point == null) {\n            point = cc.v2(0, this._gameBoxLife_Y);\n        }\n        point.y = this._gameBoxLife_Y;\n        ball.setPosition(point);\n        // 类型改为Static不可掉落\n        (ball.getComponent(cc.RigidBody) as cc.RigidBody).type = cc.RigidBodyType.Static;\n        let _scale = 1 + Math.log(_nextBallNum)/Math.log(2)/10.0\n        ball.runAction(cc.sequence(cc.spawn(cc.rotateBy(0.5,360), cc.scaleTo(0.5,_scale), cc.fadeIn(0.5)), cc.callFunc(function(){\n            this._nextBall = ball;\n        }.bind(this))))\n    }\n\n    onClick(event) {\n        const _startLocation = (event.touch as cc.Touch).getStartLocation();\n        const _endLocation = (event.touch as cc.Touch).getLocation();\n        // 因为手指滑动的时候增加了加速度,这里需要判断是拖拽后触发还是点击触发\n        if (Math.abs(_startLocation.x - _endLocation.x) < 0.2) {\n            var point = this.gameBox.convertTouchToNodeSpaceAR(event);\n            point.y = this._gameBoxLife_Y;\n            this._lastTouchPosition = point;\n            this._nextBall.setPosition(point);\n        }\n        (this._nextBall.getComponent(cc.RigidBody) as cc.RigidBody).type = cc.RigidBodyType.Dynamic;\n\n        this._nextBall = null;\n        // 生成下一个球\n        setTimeout(function() {\n            this.makeDefaultBall();\n        }.bind(this), 500);\n    }\n\n    onMoveBall(delta: cc.Vec2) {\n        const _nextBallPosition = this._nextBall.position;\n        // 拖拽加速度\n        const _position = cc.v2(_nextBallPosition.x + (delta.x * 1.5), _nextBallPosition.y)\n        // 边界检查\n        if (_position.x < this.gameBox.convertToNodeSpaceAR(cc.v2(0)).x + this._nextBall.width/2) {\n            _position.x = this.gameBox.convertToNodeSpaceAR(cc.v2(0)).x + this._nextBall.width/2;\n        }\n        if (_position.x > this.gameBox.convertToNodeSpaceAR(cc.v2(0)).x + this.gameBox.width - this._nextBall.width/2) {\n            _position.x = this.gameBox.convertToNodeSpaceAR(cc.v2(0)).x + this.gameBox.width - this._nextBall.width/2;\n        }\n        this._nextBall.setPosition(_position);\n        this._lastTouchPosition = _position;\n    }\n\n    // 生成鱼儿\n    generateFishes() {\n        this.fishAtlas.getSpriteFrames().forEach(function(spriteFrameItem) {\n            let fish = cc.instantiate(this.fishPrefab);\n            fish.getComponent(cc.Sprite).spriteFrame = spriteFrameItem;\n            this.water.addChild(fish);\n        }.bind(this));\n    }\n}\n"]}