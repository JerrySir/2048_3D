{"version":3,"sources":["../../../../assets/Script/assets/Script/Fish.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn TypeScript:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class NewClass extends cc.Component {\n\n    @property(cc.Label)\n    label: cc.Label = null;\n\n    @property\n    text: string = 'hello';\n\n    _waterNode: cc.Node = null;\n    _runloopAction: cc.Action = null;\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this._waterNode = this.node.parent;\n\n        cc.systemEvent.on('FishJump', function(){\n            this.node.stopAction(this._runloopAction);\n            // 跳跃上升\n            let jumpUp = cc.moveBy(0.2, cc.v2(0, 30)).easing(cc.easeCubicActionOut());\n            // 下落\n            let jumpDown = cc.moveBy(0.1, cc.v2(0, -30)).easing(cc.easeCubicActionIn());\n            this.node.runAction(cc.sequence(cc.delayTime(Math.random()*1), jumpUp, jumpDown, cc.callFunc(function(){\n                this.refreshPosition();\n            }.bind(this))));\n        }.bind(this));\n    }\n\n    start () {\n        this.refreshPosition();\n    }\n\n    refreshPosition() {\n        let newPosition = this.getRandomPosition();\n        let scaleAction = cc.scaleTo(0.3, this.node.x > newPosition.x ? 1 : -1, 1);\n\n        let temp = this.node.position.sub(newPosition);\n        let degree = this.getDegree(temp);\n        let rotationAction = cc.rotateTo(0.2, this.node.x < newPosition.x ? degree : degree);\n        \n        let randomTime = Math.random()*3;\n        this.node.runAction(cc.sequence(scaleAction, rotationAction, cc.moveTo(randomTime+2, newPosition).easing(cc.easeQuadraticActionOut()), cc.delayTime(randomTime+1), cc.callFunc(function(){\n            this.refreshPosition();\n        }.bind(this))));\n    }\n\n    getRandomPosition(): cc.Vec2 {\n        let waterPosition = this._waterNode.convertToNodeSpaceAR(cc.v2(0));\n        // Fish的直径为80\n        let randomPosition = cc.v2({x: waterPosition.x + Math.random()*(this._waterNode.width - 80)+40, y: waterPosition.y + Math.random()*(this._waterNode.height - 80)+40});\n        return randomPosition;\n    }\n\n    getDegree(vector: cc.Vec2): number{\n        let degree = Math.atan(vector.y / vector.x) / Math.PI * 180;\n        if(vector.x >= 0){\n            if(vector.y < 0){\n                degree += 360;\n            }\n        }else{\n            if(vector.y > 0){\n                // degree += 180;\n            }else{\n                // degree += 180;\n            }\n        }\n        return degree;\n    }\n\n    onDestroy() {\n        this.node.stopAction(this._runloopAction);\n        cc.systemEvent.off('FishJump');\n    }\n\n    // update (dt) {}\n}\n"]}